{% extends "layout.html" %}
{% block content %}
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
  />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>

  <style>
    body, html {
      background-color: #104efb;
    }
    .mod {
      background-color: white;
      box-shadow: 0 0 19px 7px #231f1f;
      border-radius: 10px;
      padding: 15px;
    }
    .container1 {
      max-width: 900px;
      margin-top: 100px;
      border-radius: 10px;
    }
    #rev {
      margin-top: 20px;
    }
    #finalbtn {
      margin-top: 20px;
    }
    #exit {
      margin-top: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    .revresult {
      font-weight: bold;
    }
    .back, .next {
      background-color: #40bd7c;
      color: white;
    }
    .exit {
      background-color: #2f3b5e;
      color: white;
    }
    /* ✅ Responsive adjustments */
    #graph {
      text-align: center;
    }
    #myChart {
      max-width: 100%;
      height: auto !important;
    }
    @media (max-width: 767px) {
      .container1 {
        width: 95%;
        margin-top: 80px;
      }
      #rev {
        margin-top: 30px;
      }
    }

    /* Navbar styles */
    .navbar {
      margin-bottom: 0;
      background-color: #2c3e50;
      border: none;
      border-radius: 0;
    }
    .navbar-brand {
      padding: 5px 15px;
    }
    .navbar-brand img {
      height: 50px;
    }
    .navbar-nav > li > a {
      color: #ecf0f1 !important;
      padding: 20px 15px;
      transition: background-color 0.3s;
    }
    .navbar-nav > li > a:hover {
      background-color: #34495e;
    }
    .navbar-toggle {
      border: 1px solid #ecf0f1;
    }
    .navbar-toggle .icon-bar {
      background-color: #ecf0f1;
    }
  </style>
</head>

<body>
  <!-- ✅ Responsive Navbar -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button
          type="button"
          class="navbar-toggle collapsed"
          data-toggle="collapse"
          data-target="#iqgenNavbar"
        >
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/home">
          <img src="{{ url_for('static', filename='images/logoimg.png') }}" alt="iQGenerator Logo" />
        </a>
      </div>

      <div class="collapse navbar-collapse" id="iqgenNavbar">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/home"><span class="glyphicon glyphicon-home"></span> Home</a></li>
          <li><a href="/TutorialList"><span class="glyphicon glyphicon-list-alt"></span> Learn</a></li>
          <li><a href="/HowItWorks"><span class="glyphicon glyphicon-transfer"></span> How It Works</a></li>
          <li><a href="/History"><span class="glyphicon glyphicon-stats"></span> History</a></li>
          <li><a href="/logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ✅ Main Content -->
  <div class="container container1">
    <div class="mod">
      <div class="row">
        <!-- Chart -->
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" id="graph">
          <canvas id="myChart"></canvas>
        </div>

        <!-- Results Table -->
        <div id="rev" class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
          <table class="table">
            <tr>
              <td>
                <span class="glyphicon glyphicon-th-list"></span>
                <span class="revresult">Number of Questions</span>
              </td>
              <td id="NOQuestions">{{ result.NOQuestions }}</td>
            </tr>
            <tr>
              <td>
                <span class="glyphicon glyphicon-ok" style="color: green"></span>
                <span class="revresult">Total right answer</span>
              </td>
              <td id="correctAns">{{ result.correctAns }}</td>
            </tr>
            <tr>
              <td>
                <span class="glyphicon glyphicon-remove" style="color: red"></span>
                <span class="revresult">Total wrong answer</span>
              </td>
              <td id="worngAns">{{ result.worngAns }}</td>
            </tr>
            <tr>
              <td>
                <span class="glyphicon glyphicon-signal"></span>
                <span class="revresult">Total marks</span>
              </td>
              <td id="score">{{ result.score }}</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Button -->
      <div class="row" id="finalbtn">
        <div class="col-lg-4 col-lg-offset-4 col-md-4 col-md-offset-4 col-sm-6 col-sm-offset-3 col-xs-12" id="exit">
          <button class="btn btn-primary btn-block" id="Exit">Go to Next Module</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js Script -->
  <script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var correct = parseInt($('#correctAns').text()) || 0;
    var wrong = parseInt($('#worngAns').text()) || 0;

    var myChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['RIGHT', 'WRONG'],
        datasets: [
          {
            data: [correct, wrong],
            backgroundColor: ['rgba(0, 255, 0, 0.6)', 'rgba(255, 0, 0, 0.6)'],
            borderColor: ['rgba(0, 255, 0, 1)', 'rgba(255, 0, 0, 1)'],
            borderWidth: 1,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        title: {
          display: true,
          text: 'YOUR SCORE',
        },
        legend: {
          position: 'bottom',
        },
      },
    });
  </script>

  <!-- Button Script -->
  <script>
    $(document).ready(function () {
      $('#Exit').click(function () {
        window.location.href = '/TutorialList';
      });

      // Auto close navbar on mobile after click
      $('#iqgenNavbar .nav a').on('click', function () {
        $('.navbar-collapse').collapse('hide');
      });
    });
  </script>
</body>
{% endblock content %}
